# ============================================
# Kap10 Web Server - Environment Variables
# ============================================
# Copy this file to .env.local and fill in your values:
#   cp .env.example .env.local
#
# DO NOT commit .env.local to version control.
#
# Four-Store Architecture:
#   1. Supabase (PostgreSQL) — Auth, app data, billing
#   2. ArangoDB            — Graph knowledge store
#   3. Temporal            — Workflow orchestration
#   4. Redis               — Cache & rate limits
#
# Minimum for dev: SUPABASE_DB_URL, BETTER_AUTH_SECRET.
# Full stack: also REDIS_URL, ARANGODB_*, TEMPORAL_ADDRESS.
# GitHub integration: also GITHUB_APP_ID, GITHUB_APP_PRIVATE_KEY.

# ============================================
# Supabase (PostgreSQL)
# ============================================
# Direct database URL for Better Auth + Prisma (pg Pool connection)
# Get from: Supabase Dashboard > Settings > Database > Connection string (URI)
SUPABASE_DB_URL=postgresql://postgres:your-password@db.your-project.supabase.co:5432/postgres

# Supabase project URL
# Get from: Supabase Dashboard > Settings > API
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co

# Supabase publishable key (client-side, safe to expose)
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Supabase secret key (server-side only, bypasses RLS)
SUPABASE_SECRET_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ============================================
# Better Auth (Required)
# ============================================
# Session encryption secret (minimum 32 characters)
# Generate: openssl rand -base64 32
BETTER_AUTH_SECRET=your-secret-key-minimum-32-characters-long-change-this

# App base URL (used for auth callbacks and redirects)
BETTER_AUTH_URL=http://localhost:3000

# ============================================
# Redis (Cache & Rate Limits)
# ============================================
# Local: redis://localhost:6379
# Docker Compose provides this automatically
REDIS_URL=redis://localhost:6379

# ============================================
# ArangoDB (Graph Store)
# ============================================
# Local: http://localhost:8529 | Docker: http://arangodb:8529
ARANGODB_URL=http://localhost:8529
ARANGODB_DATABASE=kap10_db
ARANGO_ROOT_PASSWORD=changeme

# ============================================
# Temporal (Workflow Orchestration)
# ============================================
# Local/Docker: localhost:7233
TEMPORAL_ADDRESS=localhost:7233

# ============================================
# GitHub OAuth (Optional — user login)
# ============================================
# Create OAuth App: https://github.com/settings/developers
# Callback URL: {BETTER_AUTH_URL}/api/auth/callback/github
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=

# ============================================
# GitHub App (Phase 1 — repository indexing)
# ============================================
# Distinct from OAuth above: OAuth is for user login; GitHub App is for repo access.
# Create GitHub App: https://github.com/settings/apps/new
#   Permissions: Repository contents (read), metadata (read), pull requests (read/write)
#   Events: push, pull_request, installation, installation_repositories
#   Callback URL: {BETTER_AUTH_URL}/api/github/callback
#   Webhook URL: {BETTER_AUTH_URL}/api/webhooks/github
# GITHUB_APP_ID=123456
# GITHUB_APP_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
# GITHUB_APP_SLUG=kap10-dev
# GITHUB_WEBHOOK_SECRET=whsec_...

# ============================================
# Google OAuth (Optional — user login)
# ============================================
# Get from: https://console.cloud.google.com/apis/credentials
# Redirect URI: {BETTER_AUTH_URL}/api/auth/callback/google
# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=

# ============================================
# Email (Resend — Optional)
# ============================================
# Required for email verification and org invitations.
# Without it, auth works but emails are skipped.
# Get from: https://resend.com/api-keys
# RESEND_API_KEY=re_...
# EMAIL_FROM=kap10 <noreply@kap10.dev>

# ============================================
# Langfuse (LLM Observability — Optional)
# ============================================
# Get from: https://cloud.langfuse.com or self-hosted
# LANGFUSE_SECRET_KEY=
# LANGFUSE_PUBLIC_KEY=
# LANGFUSE_BASEURL=https://cloud.langfuse.com

# ============================================
# PostHog Analytics (Optional)
# ============================================
# Get from: https://app.posthog.com/project/settings
# NEXT_PUBLIC_POSTHOG_KEY=phc_...
# NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com

# ============================================
# Sentry Error Tracking (Optional)
# ============================================
# Get from: https://sentry.io/settings/projects/your-project/keys/
# SENTRY_DSN=https://...@sentry.io/...

# ============================================
# Embedding Model (Phase 3 — Semantic Search)
# ============================================
# Local CPU embedding model — no API key needed, $0 cost.
# The model (~500MB ONNX) is downloaded once on first use and cached.
# These defaults work out of the box; override only for custom models.
# EMBEDDING_MODEL_NAME=nomic-ai/nomic-embed-text-v1.5
# EMBEDDING_DIMENSIONS=768                        # Matryoshka: set to 256 or 384 to save ~66% storage
# EMBEDDING_BATCH_SIZE=100
# EMBEDDING_MODEL_VERSION=nomic-v1.5-768           # Auto-computed from model+dims if not set

# ============================================
# Graph Snapshots (Phase 10a — Local-First Intelligence)
# ============================================
# Supabase Storage bucket for msgpack graph exports
# GRAPH_SNAPSHOT_BUCKET=graph-snapshots
# Snapshot staleness threshold (hours) before CLI warns
# GRAPH_SNAPSHOT_TTL_HOURS=24
# Cron schedule for automatic snapshot regeneration
# GRAPH_SYNC_CRON=0 2 * * *

# ============================================
# MCP Server (Phase 2 — Hosted MCP)
# ============================================
# MCP_SERVER_URL=https://mcp.kap10.dev
# MCP_SERVER_PORT=8787

# ============================================
# Public
# ============================================
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ============================================
# Build
# ============================================
# Enable bundle analysis (true/false)
ANALYZE=false
